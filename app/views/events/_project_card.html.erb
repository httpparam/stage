<% is_admin = local_assigns[:is_admin] || false %>
<% event = local_assigns[:event] || @event %>
<div class="bg-surface0 rounded-2xl border border-surface2 overflow-hidden hover:border-mauve/50 transition-colors">
  <div class="p-6">
    <div class="flex items-start justify-between mb-4">
      <h3 class="text-lg font-semibold text-text"><%= project.name %></h3>
      <% if is_admin %>
        <%= button_to event_project_path(event, project), method: :delete, class: "text-red hover:text-red/70 transition-colors", form: { data: { turbo_confirm: "Remove this project?" } } do %>
          <svg class="size-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
        <% end %>
      <% end %>
    </div>

    <p class="text-sm text-subtext0 mb-4 line-clamp-2"><%= project.description || "No description" %></p>

    <div class="flex items-center gap-3 mb-4 text-sm text-subtext0">
      <span class="inline-flex items-center gap-x-1">
        <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
        <%= project.user.display_name %>
      </span>
      <span class="inline-flex items-center gap-x-1">
        <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
        <%= project.vote_count %> votes
      </span>
    </div>

    <div class="flex items-center justify-between">
      <div class="flex gap-2">
        <% if project.demo_url.present? %>
          <%= link_to project.demo_url, target: "_blank", class: "inline-flex items-center gap-x-1 text-xs text-subtext0 hover:text-mauve transition-colors" do %>
            <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h3"/><path d="M15 3a6 6 0 0 1 6 6v6"/></svg>
            Demo
          <% end %>
        <% end %>
        <% if project.github_url.present? %>
          <%= link_to project.github_url, target: "_blank", class: "inline-flex items-center gap-x-1 text-xs text-subtext0 hover:text-mauve transition-colors" do %>
            <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 4-2 4-2 0 1-2-2-2-2-.3.2-.6.3-1 .2 0-.7.3-1.2.5-1.7.6-1.6.2-3.2-.5-4.8-.8-.7-.2-1.2-.5-1.2-.5 0-1.2-2-1.2 2 0 1.6.2 3.2.5 4.8.3.5.6.8.5 1.1.5h9.8c.4 0 .8-.2 1.1-.5.3-.3.5-.7.5-1.1V6.5L15.5 2z"/><path d="M3 7.6v12.8c0 .4.2.8.5 1.1.3.3.7.5 1.1.5h9.8"/><path d="M15 2v5h5"/></svg>
            GitHub
          <% end %>
        <% end %>
      </div>

      <%# Vote Button %>
      <% if project.voted_by?(current_user) %>
        <%= button_to vote_event_project_path(event_id: event.id, id: project.id), method: :delete, class: "inline-flex items-center gap-x-2 py-2 px-4 rounded-lg text-sm font-semibold bg-mauve text-crust hover:bg-pink transition-colors", form: { data: { turbo_confirm: "Remove your vote?" } } do %>
          <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
          Voted
        <% end %>
      <% else %>
        <%= button_to vote_event_project_path(event_id: event.id, id: project.id), method: :post, class: "inline-flex items-center gap-x-2 py-2 px-4 rounded-lg text-sm font-medium bg-surface1 text-text hover:bg-surface2 hover:text-mauve transition-colors" do %>
          <svg class="size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
          Vote
        <% end %>
      <% end %>
    </div>
  </div>
</div>
